<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#FFFFFF"/>
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/000000/FFFFFF?text=♂">
    <link rel="manifest" href="manifest.json">

    <title>Symbol Sound Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        #playSoundSymbol {
            transition: transform 0.1s;
        }
        #playSoundSymbol:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="bg-white flex items-center justify-center h-screen">

    <!-- The SVG symbol is now the button -->
    <svg id="playSoundSymbol" class="w-64 h-64 text-black cursor-pointer" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 4C13.6569 4 15 5.34315 15 7C15 8.65685 13.6569 10 12 10C10.3431 10 9 8.65685 9 7C9 5.34315 10.3431 4 12 4Z"/>
        <path d="M17 20V12H18C18.5523 12 19 11.5523 19 11V10C19 9.44772 18.5523 9 18 9H6C5.44772 9 5 9.44772 5 10V11C5 11.5523 5.44772 12 6 12H7V20H9V15H15V20H17Z"/>
    </svg>

    <script>
        // --- PWA Service Worker and Manifest Setup ---
        
        // 1. Create and register the Service Worker
        const swCode = `
            const CACHE_NAME = 'symbol-player-pwa-v1';
            const urlsToCache = [
                '/',
                '/index.html'
            ];

            self.addEventListener('install', event => {
                event.waitUntil(
                    caches.open(CACHE_NAME)
                        .then(cache => {
                            console.log('Opened cache');
                            return cache.addAll(urlsToCache);
                        })
                );
            });

            self.addEventListener('fetch', event => {
                event.respondWith(
                    caches.match(event.request)
                        .then(response => {
                            if (response) {
                                return response;
                            }
                            return fetch(event.request);
                        })
                );
            });
        `;
        const swBlob = new Blob([swCode], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(swBlob);

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register(swUrl)
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // 2. Create and link the Manifest file
        const manifest = {
            "name": "Symbol Sound Player",
            "short_name": "SymbolSound",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#ffffff",
            "theme_color": "#ffffff",
            "description": "A simple PWA that plays a sound when the symbol is clicked.",
            "icons": [
                {
                    "src": "https://placehold.co/192x192/000000/FFFFFF?text=♂",
                    "sizes": "192x192",
                    "type": "image/png"
                },
                {
                    "src": "https://placehold.co/512x512/000000/FFFFFF?text=♂",
                    "sizes": "512x512",
                    "type": "image/png"
                }
            ]
        };
        const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
        const manifestUrl = URL.createObjectURL(manifestBlob);
        document.querySelector('link[rel="manifest"]').setAttribute('href', manifestUrl);


        // --- Sound Logic ---
        const playSoundSymbol = document.getElementById('playSoundSymbol');
        let audioContext;

        playSoundSymbol.addEventListener('click', () => {
            // Create AudioContext on the first user interaction
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            // Create an OscillatorNode for the tone
            const oscillator = audioContext.createOscillator();
            // Create a GainNode to control volume (and prevent clipping)
            const gainNode = audioContext.createGain();

            // Configure the sound
            oscillator.type = 'sine'; // A clean, pure tone
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // 440 Hz is the note 'A'
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.5, audioContext.currentTime + 0.01); // Ramp up volume quickly

            // Connect the nodes: oscillator -> gain -> speakers
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            // Start the sound
            oscillator.start(audioContext.currentTime);

            // Stop the sound after 0.5 seconds
            gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.5);
            oscillator.stop(audioContext.currentTime + 0.5);
        });
    </script>
</body>
</html>